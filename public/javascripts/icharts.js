$(function(){function t(t,e){$.post("/statistics/",t,function(t){var a=[];t.forEach(function(t){var e={name:t._id[Object.keys(t._id)[0]],value:t.total,color:c()};a.push(e)}),e(a)})}function e(t){$.post("/statistics/",t,function(t){$("#chart-table").html(""),0!==Object.keys(t[0]._id).length&&(createTable($("#chart-table")[0],t),$("#chart-Modal").modal({keyboard:!0}))})}function a(t){var e=new iChart.Donut2D({render:"canvasDiv",data:t,title:{text:"Laptop Distribution of Companies",color:"#3e576f",offsety:-10},footnote:{text:"Data from ACBSIT Nanjing",color:"#486c8f",fontsize:11,padding:"0 38",offsetx:-50},center:{text:"100%",color:"#3e576f",shadow:!0,shadow_blur:2,shadow_color:"#557797",shadow_offsetx:0,shadow_offsety:0,fontsize:40},sub_option:{label:{background_color:null,sign:!1,padding:"0 4",border:{enable:!1,color:"#666666"},fontsize:11,fontweight:600,color:"#4572a7"},border:{width:2,color:"#ffffff"}},shadow:!0,shadow_blur:6,shadow_color:"#aaaaaa",shadow_offsetx:0,shadow_offsety:0,background_color:"#fefefe",offset_angle:-120,showpercent:!0,decimalsnum:2,width:1400,height:400,radius:120});e.draw()}function o(t){new iChart.Bar2D({render:"canvasDiv",data:t,title:"Quantity between OSs",footnote:"Data from ACBSIT Nanjing",width:1400,height:400,animation:!0,animation_duration:800,coordinate:{width:740,height:380,scale:[{position:"bottom",start_scale:0,scale_space:40,listeners:{parseText:function(t,e,a){return{text:t+" pcs"}}}}]},rectangle:{listeners:{drawText:function(t,e){return e+"%"}}},sub_option:{listeners:{click:function(t,a,o){var n="department=&Vendor=&OS="+t.get("name")+"&CPU=&RAM=&group=department&group=ComputerName&group=displayName&company="+$("#company-chart").val();$("#myModalLabel").text(t.get("name")),e(n)}}}}).draw()}function n(t){t.sort(function(t,e){return parseInt(t.name)-parseInt(e.name)});var a=new iChart.Column2D({render:"canvasDiv",data:t,title:"Quantity between RAMs",footnote:{text:"Data from ACBSIT Nanjing",color:"#486c8f",fontsize:11,padding:"0 38",offsetx:50},width:1400,height:400,animation:!0,animation_duration:800,shadow:!0,shadow_color:"#c7c7c7",column_space:10,column_width:70,coordinate:{scale:[{position:"left",start_scale:0,scale_space:20,listeners:{parseText:function(t,e,a){return{text:t+" pcs"}}}}]},sub_option:{listeners:{click:function(t,a,o){var n="department=&Vendor=&OS=&CPU=&RAM="+t.get("name")+"&group=department&group=ComputerName&group=displayName&company="+$("#company-chart").val();$("#myModalLabel").text(t.get("name")),e(n)}}}});a.draw()}function r(t){t.sort(function(t,e){return e.value-t.value});var a=new iChart.Column2D({render:"canvasDiv",data:t,title:{text:"Quantity between Models",color:"#3e576f"},footnote:{text:"Data from ACBSIT Nanjing",color:"#909090",fontsize:11,offsety:-100,offsetx:-50},width:1400,height:650,offsety:-100,label:{fontsize:11,textAlign:"right",textBaseline:"middle",rotate:-45,color:"#666666"},tip:{enable:!0,listeners:{parseText:function(t,e,a,o,n){var r=new String(a);return r=r.split("").reverse().join("").replace(/(\d{3})/g,"$1,").split("").reverse(),","==r[0]&&r.shift(),r=r.join(""),e+"<br/>"+r+"pcs<br/>proportion of the total:<br/>"+(a/this.get("total")*100).toFixed(2)+"%"}}},animation:!0,animation_duration:800,shadow:!0,shadow_blur:2,shadow_color:"#aaaaaa",shadow_offsetx:1,shadow_offsety:0,column_space:5,column_width:100,sub_option:{label:!1,border:{width:2,color:"#ffffff"},listeners:{click:function(t,a,o){var n="department=&Vendor=&OS=&CPU=&Model="+t.get("name")+"&group=department&group=ComputerName&group=displayName&company="+$("#company-chart").val();$("#myModalLabel").text(t.get("name")),e(n)}}},coordinate:{background_color:null,grid_color:"#c0c0c0",width:960,height:300,axis:{color:"#c0d0e0",width:[0,0,1,0]},scale:[{position:"left",start_scale:0,scale_space:5,scale_width:9,scale_enable:!1,label:{fontsize:11,color:"#666666"},listeners:{parseText:function(t,e,a){return{text:t}}}}]}});a.plugin(new iChart.Custom({drawFn:function(){var t=a.getCoordinate(),e=t.get("originx"),o=t.get("originy");a.target.textAlign("start").textBaseline("bottom").textFont("600 11px Verdana").fillText("Quantity(pcs)",e-40,o-10,!1,"#6d869f")}})),a.draw()}function i(t){t.sort(function(t,e){return e.value-t.value}),t=t.slice(0,10),new iChart.Bar2D({render:"canvasDiv",background_color:"#EEEEEE",data:t,title:"CPU TOP10",footnote:"Data from ACBSIT Nanjing",width:1400,height:450,coordinate:{width:840,height:360,axis:{width:[0,0,1,1]},scale:[{position:"bottom",start_scale:0,scale_space:2}]},animation:!0,sub_option:{listeners:{parseText:function(t,e){return e+" pcs"},click:function(t,a,o){var n="department=&Vendor=&OS=&CPU="+t.get("name")+"&RAM=&group=department&group=ComputerName&group=displayName&company="+$("#company-chart").val();$("#myModalLabel").text(t.get("name")),e(n)}}},legend:{enable:!1}}).draw()}function c(){var t=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"],e="#";return[1,1,1].forEach(function(a,o){e+=t[parseInt(15*Math.random())]}),e}var s={company:{q:"department=&Vendor=&OS=&CPU=&RAM=&group=company&group=&company=",type:a},os:{q:"department=&Vendor=&OS=&CPU=&RAM=&group=OS&group=&company=",type:o},ram:{q:"department=&Vendor=&OS=&CPU=&RAM=&group=RAM&group=&company=",type:n},model:{q:"department=&Vendor=&OS=&CPU=&RAM=&group=Model&group=&group=&company=",type:r},cpu:{q:"department=&Vendor=&OS=&CPU=&RAM=&group=CPU&group=&group=&company=",type:i}};t(s.company.q,s.company.type),$("#select-chart").change(function(){var e=s[$(this).val()];t(e.q+$("#company-chart").val(),e.type)}),$("#company-chart").change(function(){var e=s[$("#select-chart").val()];t(e.q+$(this).val(),e.type)})});