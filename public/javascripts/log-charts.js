$(function(){function e(e){for(var t=e.getElementsByTagName("tr"),a=0,n=t.length;a<n;a++){var r=t[a].getElementsByTagName("td")[4],i=t[a].getElementsByTagName("td")[1];switch(r.textContent){case"add":i.innerHTML='<a href="/details/'+i.innerText+'" target="_blank">'+i.innerText+"</a>",r.innerHTML='<span class="glyphicon glyphicon-ok text-success"></span>';break;case"update":i.innerHTML='<a href="/details/'+i.innerText+'" target="_blank">'+i.innerText+"</a>",r.innerHTML='<span class="glyphicon glyphicon-refresh text-warning"></span>';break;case"delete":r.innerHTML='<span class="glyphicon glyphicon-remove text-danger"></span>'}}}function t(e){var t=new Date;t.setDate(t.getDate()-e+1);for(var a=[],n=0;n<e;n++)a.push(t.getMonth()+1+"-"+t.getDate()),t.setDate(t.getDate()+1);return a}function a(e,a){if(e){for(var n=new Array(a),r=new Array(a),i=new Array(a),l=t(a),o=0;o<a;o++)n[o]=0,r[o]=0,i[o]=0;e.forEach(function(e){switch(e._id.action){case"add":n[l.indexOf(e._id.month+"-"+e._id.day)]=e.total;break;case"delete":r[l.indexOf(e._id.month+"-"+e._id.day)]=e.total;break;case"update":i[l.indexOf(e._id.month+"-"+e._id.day)]=e.total}});var s=echarts.init($("#chart")[0]),c={title:{text:"The lastest month's logs"},tooltip:{},legend:{data:["add","update","delete"]},xAxis:{data:l},yAxis:{},color:["#75b15d","#ffa500","#e21010"],series:[{name:"add",type:"bar",stack:"total",data:n},{name:"update",type:"bar",stack:"total",data:i},{name:"delete",type:"bar",stack:"total",data:r}]};s.setOption(c)}}var n=$("#refresh-log").click(function(){$("#log-list").html(""),$.post("/logs/",function(t){t&&(createTable($("#log-list")[0],t,e),$("#log-count").text(t.length),$("#log-panel").animate({scrollTop:$("#log-panel").prop("scrollHeight")},800))})});n.click(),a(groupLog,31)});